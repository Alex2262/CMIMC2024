import random
import time

import math

GAME_TIME = 10

init_time = time.time()

GRID_RADIUS = 4
coordinates = []


def sigmoid(x):
    return 1 / (1 + math.exp(-x))


def ReLU(x):
    return max(x, 0)


def ReLU_derivative(x):
    return 1 if x > 0 else 0


def dot_product(v1, v2):

    return sum(v1[i] * v2[i] for i in range(len(v1)))


def softmax(x):
    largest = max(x)
    e_x = [math.exp(i - largest) for i in x]
    sum_e_x = sum(e_x)
    return [i / sum_e_x for i in e_x]


def cross_entropy_loss(predicted, actual):
    # Adding a small constant to avoid log(0)
    epsilon = 1e-15
    loss = 0

    for i in range(len(actual)):
        loss -= actual[i] * math.log(max(predicted[i], epsilon))

    return loss


def clamp(x, lower_bound, upper_bound):
    return max(min(x, upper_bound), lower_bound)


def quantize(x):
    return clamp(round(x * 64), -128, 127)


def get_weight(ws, idx):
    s = ws[idx] + ws[idx + 1] + ws[idx + 2]
    # print(idx, s, (int(s) - 128.0) / 64.0)
    return (int(s) - 128.0) / 64.0


def get_char(x):
    a = quantize(x) + 128
    if a >= 100:
        return str(a)

    if a >= 10:
        return "0" + str(a)

    return "00" + str(a)


PERSPECTIVE_TO_PLAYER = [[0,1,2], [2,0,1], [1,2,0]]


def get_inputs(board, player):
    inputs = [0] * INPUT_SIZE

    for i in range(96):
        coord = coordinates[i]
        if coord not in board:
            continue

        c_player = board[coord]
        p_player = PERSPECTIVE_TO_PLAYER[player][c_player]

        inputs[p_player * 96 + i] = 1

    return inputs


class NeuralNetwork:
    def __init__(self, input_size, output_size):
        self.input_size = input_size
        self.output_size = output_size

        self.lower_bound = -1.98
        self.upper_bound = 1.98

        self.weights = [[random.uniform(self.lower_bound, self.upper_bound) for _ in range(input_size)]
                         for _ in range(output_size)]

        self.bias = [random.uniform(self.lower_bound, self.upper_bound) for _ in range(output_size)]

        self.activation = None

    def feedforward(self, inputs):
        self.activation = []

        for i in range(self.output_size):
            if i < 96 and (inputs[i] == 1 or inputs[96 + i] == 1 or inputs[96 * 2 + i] == 1):
                self.activation.append(-100_000_000)
                continue

            self.activation.append(ReLU(dot_product(inputs, self.weights[i]) + self.bias[i]))

        return softmax(self.activation)

    def init_weights(self, ws):
        idx = 0

        for i in range(self.output_size):
            for j in range(self.input_size):
                self.weights[i][j] = get_weight(ws, idx)
                idx += 3

        for i in range(self.output_size):
            self.bias[i] = get_weight(ws, idx)
            idx += 3


class Move:
    def __init__(self, x, y, z, passing):
        self.x = x
        self.y = y
        self.z = z
        self.p = passing

    def get_key(self):
        return self.x, self.y, self.z


class Node:
    def __init__(self, parent, last_move, pass_length):
        self.parent = parent

        self.children_start = 0
        self.children_end = 0

        self.win_count = 0
        self.visits = 0

        self.last_move = last_move

        self.pass_length = pass_length

    def copy(self):
        new_node = Node(self.parent, self.last_move, self.pass_length)
        new_node.children_start = self.children_start
        new_node.children_end = self.children_end
        new_node.win_count = self.win_count
        new_node.visits = self.visits

        return new_node


class Tree:
    def __init__(self):
        self.graph = []


def ALL_NEIGHBOR(x1, y1, z1):
    return (x1 + 1, y1, z1), (x1 - 1, y1, z1), (x1, y1 + 1, z1), (x1, y1 - 1, z1), (x1, y1, z1 + 1), (x1, y1, z1 - 1)


def SELECT_VALID(lis):
    return [(x1, y1, z1) for (x1, y1, z1) in lis
            if 1 <= x1 + y1 + z1 <= 2
            and -GRID_RADIUS + 1 <= x1 <= GRID_RADIUS
            and -GRID_RADIUS + 1 <= y1 <= GRID_RADIUS
            and -GRID_RADIUS + 1 <= z1 <= GRID_RADIUS]


def set_node_coordinates():
    global coordinates

    for x in range(-GRID_RADIUS + 1, GRID_RADIUS + 1):
        for y in range(-GRID_RADIUS + 1, GRID_RADIUS + 1):
            for z in range(-GRID_RADIUS + 1, GRID_RADIUS + 1):
                # Check if node is valid
                if 1 <= x + y + z <= 2:
                    coordinates.append((x, y, z))


def get_diameter(board, start_node, visit: dict, use_visit):
    def neighbors(node):
        # return SELECT_VALID(ALL_NEIGHBOR(*(node)))
        return NEIGHBOR_LIST[node]

    def con(node):  # Find connected component and respective degrees
        # print(node)

        if use_visit:
            visit[node] = 1

        connected[node] = -1
        cnt = 0
        for neighbor in neighbors(node):
            if neighbor in board and board[neighbor] == player:
                cnt += 1
                if neighbor not in connected:
                    con(neighbor)
        connected[node] = cnt

    def dfs(node, visited=set()):
        visited.add(node)
        max_path_length = 0
        for neighbor in neighbors(node):
            if neighbor in board and board[neighbor] == player and neighbor not in visited:
                path_length = dfs(neighbor, visited.copy())
                max_path_length = max(max_path_length, path_length)
        return max_path_length + 1

    player = board[start_node]

    '''
    try:
        player = board[start_node]
    except Exception as exc:
        print("node empty?")
        print(exc)
        return 0
    '''

    connected = dict()
    con(start_node)
    if len(connected) <= 3:  # must be a line
        return len(connected)
    if 4 <= len(connected) <= 5:  # a star if we have a deg-3 node, a line otherwise
        if 3 in connected.values():  # It's a star!
            return len(connected) - 1
        return len(connected)
    if 6 == len(connected):
        three = list(connected.values())
        if 3 in connected.values():
            three.remove(3)
            if 3 in three:
                return 4  # this is a shape x - x - x - x
                #                     x   x
        return 5  # diameter is 5 otherwise
    # For the larger(>6) ones, diameter must be larger than 5, so we just return 5
    return 5


def score(board):  # return current score for each player
    visit = {pos: 0 for pos in coordinates}
    scores = {0: 0, 1: 0, 2: 0}
    for pos in board.keys():
        if not visit[pos]:
            d = get_diameter(board, pos, visit, True)
            if d:
                scores[board[pos]] += TABLE[d]
    return scores


def hex_to_pixel(x, y, z):
    xc = round(2 * (x / 2 + y / 2 - z))
    yc = round(-(2 * math.sqrt(3)) * (x * math.sqrt(3) / 2 - y * math.sqrt(3) / 2))

    # print(x, y, z, (xc, yc))

    return xc, yc


RESET_COLOR = "\033[0m"
BLACK_COLOR = "\033[30m"
RED_COLOR = "\033[31m"
WHITE_COLOR = "\033[97m"
GREEN_COLOR = "\033[32m"


def softmax(x):
    e_x = [math.exp(i) for i in x]
    sum_e_x = sum(e_x)
    return [i / sum_e_x for i in e_x]


def print_board(board, move):
    mat = [[-2 for _ in range(23)] for _ in range(43)]

    for coord in coordinates:
        xc, yc = hex_to_pixel(*coord)

        # print(coord, yc, xc)
        mat[round(yc) + 21][round(xc) + 11] = -1

    for coord in board:
        xc, yc = hex_to_pixel(*coord)
        mat[round(yc) + 21][round(xc) + 11] = board[coord]

    if move is not None:
        xc, yc = hex_to_pixel(*move.get_key())
        mat[round(yc) + 21][round(xc) + 11] = 3

    for row in range(43):
        s = ""
        for col in range(23):
            if mat[row][col] == -2:
                s += " "

            elif mat[row][col] == -1:
                s += "_"

            elif mat[row][col] == 0:
                s += WHITE_COLOR + "W" + RESET_COLOR

            elif mat[row][col] == 1:
                s += BLACK_COLOR + "B" + RESET_COLOR

            elif mat[row][col] == 2:
                s += RED_COLOR + "R" + RESET_COLOR

            else:
                s += GREEN_COLOR + "G" + RESET_COLOR

        if s.isspace():
            continue

        print(s)


class MCTS:

    def __init__(self):

        self.board = {}
        self.player = 0

        self.iterations = 0
        self.sel_depth = 0

        self.root_node_index = 0
        self.max_time = 1

    def get_result(self, current_board):

        score_dict = score(current_board)
        result = [-1, -1, -1]

        small = min(score_dict.values())
        large = max(score_dict.values())

        count_large = 0
        count_small = 0

        for i in range(3):
            if score_dict[i] == large:
                count_large += 1
            if score_dict[i] == small:
                count_small += 1

        # First place score
        large_score = 1 / count_large

        # Last place score
        # Two players are tied at last place receive a very small bonus
        # Three players tying for last place will not occur, since the first place code will run instead
        small_score = 0.15 if count_small == 2 else 0

        for i in range(3):
            if score_dict[i] == large:
                result[i] = large_score
            elif score_dict[i] == small:
                result[i] = small_score
            else:
                result[i] = 0.3

        return result

    def descend_to_root(self, node_index):
        while node_index != self.root_node_index:
            last_move = tree.graph[node_index].last_move

            if not last_move.p:
                del self.board[last_move.get_key()]

            node_index = tree.graph[node_index].parent
            self.player = ((self.player - 1) + 3) % 3

    def selection(self):

        leaf_node_index = self.root_node_index

        depth = 0

        while True:

            leaf_node = tree.graph[leaf_node_index]

            n_children = leaf_node.children_end - leaf_node.children_start
            if n_children <= 0:
                break

            best_puct = -100000.0

            policies = nn.feedforward(get_inputs(self.board, self.player))

            # SELECTING BEST CHILD
            for i in range(n_children):
                child_node_index = leaf_node.children_start + i
                child_node = tree.graph[child_node_index]

                last_move = child_node.last_move

                policy = 0

                if last_move.p:
                    policy = policies[96]
                else:
                    for j in range(96):
                        if last_move.x == coordinates[j][0] and last_move.y == coordinates[j][1] and last_move.z == coordinates[j][2]:
                            policy = policies[j]
                            break

                exploration_score = EXPLORATION_CONSTANT * math.sqrt(leaf_node.visits)
                prior_score = policy * (exploration_score / (1 + child_node.visits))

                value_score = 0 if child_node.visits == 0 else \
                              child_node.win_count / child_node.visits

                puct = EXPLORATION_CONSTANT * policy + 0.5 if child_node.visits == 0 else \
                       prior_score + value_score

                if puct > best_puct:
                    leaf_node_index = child_node_index
                    best_puct = puct

            last_move = tree.graph[leaf_node_index].last_move

            if not last_move.p:
                self.board[last_move.get_key()] = self.player

            self.player = (self.player + 1) % 3
            depth += 1

        self.sel_depth = max(self.sel_depth, depth)
        return leaf_node_index

    def expansion(self, node_index):

        node = tree.graph[node_index]
        node.children_start = len(tree.graph)

        for coord in coordinates:
            if coord in self.board:
                continue

            tree.graph.append(Node(node_index, Move(coord[0], coord[1], coord[2], False), 0))

        # Pass move
        if node.pass_length < 3:
            tree.graph.append(Node(node_index, Move(0, 0, 0, True), node.pass_length + 1))

        node.children_end = len(tree.graph)

    def simulation(self, node_index):

        # node = self.tree.graph[node_index]

        current_player = self.player
        current_board = self.board.copy()

        pass_length = tree.graph[node_index].pass_length

        # print("SIMULATION:")
        for depth in range(MAX_DEPTH):

            if pass_length >= 3:
                break

            moves = []
            for coord in coordinates:
                if coord in current_board:
                    continue

                moves.append(Move(coord[0], coord[1], coord[2], False))

            # Can only keep passing from here, so just break anyway
            if len(moves) == 0:
                break

            good_moves = []
            for move in moves:
                current_board[move.get_key()] = current_player
                d = get_diameter(current_board, move.get_key(), {}, False)
                del current_board[move.get_key()]

                if d < 5:
                    good_moves.append(move)

            if len(good_moves) == 0:
                pass_length += 1
            else:
                pass_length = 0
                random_move = random.choice(good_moves)
                current_board[random_move.get_key()] = current_player

            current_player = (current_player + 1) % 3

        return self.get_result(current_board)

    def back_propagation(self, node_index, result):
        current_node_index = node_index
        current_player = self.player

        while True:
            if current_node_index == -1:
                break

            current_node = tree.graph[current_node_index]

            # last_move = current_node.last_move

            current_node.visits += 1

            # Take the previous player, since the current node's value is based on the previous player's move
            previous_player = ((current_player - 1) + 3) % 3
            current_node.win_count += result[previous_player]

            current_node_index = current_node.parent

            # rotate backwards in back_propagation
            current_player = previous_player

    def search(self):
        self.sel_depth = 0
        # print("PLAYER:", self.player)
        # print_board(self.board, None)

        selected_node_index = self.root_node_index

        self.iterations = 0
        for self.iterations in range(MAX_ITERATIONS):
            # print("iteration:", iteration)
            # print(self.player)

            self.descend_to_root(selected_node_index)
            selected_node_index = self.selection()
            selected_node = tree.graph[selected_node_index]

            # print("Current Node: ")
            # print("Score:", selected_node.win_count)
            # print("Visits:", selected_node.visits)

            n_children = selected_node.children_end - \
                         selected_node.children_start

            if (n_children <= 0 and selected_node.visits >= 1) or selected_node_index == self.root_node_index:
                self.expansion(selected_node_index)

            # New leaf selected node index, make the corresponding move
            if n_children > 0:
                selected_node_index = random.randint(selected_node.children_start, selected_node.children_end - 1)
                selected_node = tree.graph[selected_node_index]

                last_move = selected_node.last_move

                if not last_move.p:
                    self.board[last_move.get_key()] = self.player

                self.player = (self.player + 1) % 3

            if selected_node.pass_length >= 3:
                simulation_result = self.get_result(self.board)
            else:
                simulation_result = self.simulation(selected_node_index)
            # print("Simulation Result:", simulation_result)

            # print("Back Propagation")
            self.back_propagation(selected_node_index, simulation_result)

            if self.iterations >= 20 and time.time() - start_time >= self.max_time:
                break

                # print(time.time() - self.start_time)
                # print(self.iterations, self.sel_depth, len(self.tree.graph))

        self.descend_to_root(selected_node_index)

        # Return the best child of root
        n_root_children = tree.graph[self.root_node_index].children_end - \
                          tree.graph[self.root_node_index].children_start

        best_index = tree.graph[self.root_node_index].children_start
        best_visits = tree.graph[best_index].visits

        policies = nn.feedforward(get_inputs(self.board, self.player))

        for it in range(n_root_children):
            root_child_index = tree.graph[self.root_node_index].children_start + it
            rc_visits = tree.graph[root_child_index].visits

            if rc_visits > best_visits:
                best_index = root_child_index
                best_visits = rc_visits

        '''
        print(self.player)
        last_move = tree.graph[best_index].last_move
        print_board(self.board, None)

        policy = 0
        if last_move.p:
            policy = policies[96]
        else:
            for j in range(96):
                if last_move.x == coordinates[j][0] and last_move.y == coordinates[j][1] and last_move.z == \
                        coordinates[j][2]:
                    policy = policies[j]
                    break

        print_board(self.board, last_move)
        print(policy)
        print(max(policies))

        best_policy_index = policies.index(max(policies))
        if best_policy_index < 96:
            coord = coordinates[best_policy_index]
            print_board(self.board, Move(coord[0], coord[1], coord[2], False))

        print(policies)
        '''
        return best_index



TABLE = {1: 0, 2: 0, 3: 1, 4: 3, 5: 0}

EXPLORATION_CONSTANT = 1.41
MAX_DEPTH = 30
MAX_ITERATIONS = 10000

set_node_coordinates()
NEIGHBOR_LIST = dict(zip(coordinates, [SELECT_VALID(ALL_NEIGHBOR(*node)) for node in coordinates]))

tree = Tree()
tree.graph.append(Node(-1, Move(0, 0, 0, True), 0))  # Root node

real_board = {}

mcts_engine = MCTS()

current_time = GAME_TIME - 6
move_count = 0

predicted_total_moves = 45
start_time = 0

# current_time -= time.time() - init_time

INPUT_SIZE = 3 * 96
OUTPUT_SIZE = 97

nn = NeuralNetwork(INPUT_SIZE, OUTPUT_SIZE)
nn_weights_str = "034044227130231204156077159040135248018044196051016118153241029242155129179063016136209210190243154036081213125190191047077054232103035041245229073133143197069249196094031214097161188239040250213011045130134198020047066243219146204061169164141243211247194002138025051002029253063080132165022132068031123178123244071019003139220014143047181186110099063129222050071132085214215111087146083128219167157214253204070202006124224204039022030018179139064230230005060076037101217027180144058015057212018237188248036116217070170023018074043094005233145151080004187012048222243147044238162151249225138222098185049003049053203063013135199036073045015214156038104163249221065150083085157127219023205052059199173217099099199203160060062215152100075014094108183048023103025130233128042105046221212043076121187011017238084020239183103088221122024210012245236248245103188215097079096004122106172161074018221077091226223141080099100058231195239072027211111065237093111123003082190145070165235213153174041211035072220174102228129092079002085006165075005008246249116186126167084139216082145075148170244135136224245137204254069198172175090012215228075234060136056009074019194192215095040135163145002220195152228172152097191213016016131169074219062086057044185022175108090029149002190179242196014152222078110065254206055173051088057027012045105091127233246233183010192119087057067117249206084254243240150157141069247189135014177097175057126113027206136089013057238209117119143083237027192164051154178202053241112032078187016189151166041063017044182044170129161234131021032035186038162026202035038128239032044202057088077172190166059072237087139028217220034156220212021078128115140142162144187206135223090147069035233086085074230236024051071195226207198189237031196191156152242243044223061063109007108169032149049248237209138062176036126161139224239119201114243163046003032113210197037051127188149141222176036019037160204082144183107230249026081117173198055188132223115035051198024201181196107203171218200073178173097237203198102127150138163144181155098146183046182212071227043086197045225021099108037160201152067031251053006129114154103173071114199252223245192120109087133068199026005082170070140067080001252130213073252150066103174052119247064226202073207168077170224052119116183175246172169082136213141218141109144040150146231006037097053004063163150229241107200149082121042195213254024067177043161219074172066151206241021132254086044248174115222038096011038222078093157132142072223053079189151131090067164159243201104249104184186107126018035254041217023077111053117185201069004057083017246153102251007233029195014212247067243033074066010062248166086103071202065124098188123057043061044028155221246086003013013187051047073225025058248150196105091113243185080158023139171084227131078150253142018049082177046123151208142019231169032208047009220018253050119053187219111013080072215050108249162159215014151124188099084207188101025241231141249043042240093185026142045018007078020117136167115099022171093037132048067190060141071124010157219124178247190182248051225123035070107052061033087093125136052207120034197184089116179142171160238209059214014238116027003255189053206178105225052220111100071194253078056223216080032152134192048220100072191122137061061060115124207250042060050167056011237186106071219217219100143091004146121172020196157005098146080210109063014186040186063093077165121126040172023122154165029182079193055003244050142041153179209079225134120053035049223162175254185164186077053187242054131240239039191063019094018215134171101162171239052232136006103180212106219130183106156063167050049254086171112084069098222041053222217085157133199087078003146135209227038152161169062230069073122238063099147197177072002044034197009080013047236117092062177180157022239080152236188224038027247213017070187153022218181022065082010195156178016100196098075071227159089252230167002091255235061049019053035115205209028020087235012015079012102016056217053213222056145002042230246241111226045198116254217225064017109021075049074212133215192022047039159057153053242011170126108245174103153160115093153077124028147065178190031145238206043110030136186110071036037039140205154230131157050189247026109051132198167076190167096132233004181129174227191244110147186227201077092113038072108150040053168161107130135058236188010003120203231236119073021180200008177220027204075211129084241009018015030213245215179209163073009002087228067135175100250059193108101092138208234112006194234222077105130147073236218254206096186058095143002199222246132183184227110003203179096113241047200161158025227215026190026201223049202232115135045051063173151030088152037247008013148132113081235114081193100100007121002128109098006049031045091136118107107005128103186214034196040146159184091217040039190086116242134067136058085190080242233178136160222151151105164078151081014244169252151062127239211110072170086038214178060013217183253066190013225174057182189186183133068215251187155091127126216013201237158179111138156129247035242250212204219199150062167216009058111232093019035237199184232001176247175208062021064202134218055194123238097105217130180127007178053178076075217152162194032039180235124075192148156117106150045192148020024117050027193093011106164249186244204111188221004146068020083110164064232107249155236204064176011120082144223189016251068179183071126143206089126161053078192214126204194206148040200089026061195163067211073207075186122041146059053101064189088029045121082022234208196102074174108030085111050182116074198027181028128242216143127134049163109219057019156019010097199175014163142245069191185135238106192057139007004188106220238242063084102094155236074235148249078171139160006115165162203100157094159156214229215053009253131251203206061191155015218241113212069103223182038046152011011077041004173082079128111074200050072047019055062201229087136131169249249227204020206115150230041005064075111216033092087054194028098070136228097193106092069120007127127032221018207159018148203188081212209024155008216158135209084024024148204234090100017061224232194104111157045244199228056110201134185061170245244132121229173223096254123013006236215167065138204193113151038254226241053017137248165066163153097230102149094187140097046070143200148052204083036127161179009185067247108129165151053228085020145237070145206183127225171143121247134113109232065092230170101022176180181251122018199127129197142112043171097194121061041118055117058138154216099213099191061090241106112236056101116068132081125169207054062184041029232083171117121145008186246111248138074104180238247191180244107048124079131229119139023070154135050237120103062095048008138241209105197039142026195171022036103002081190169021036058049235199135058253174142097176062103080113022017011017152089081012088158171243003168145096018154209006116177180151153212035160137093033153192225035066161060195048190085043075192125251202247163181203158233086113104022135165014096122113203194182235024119044182055086216212143127213209216242183060076227172111191067243192075220253075171234126173069196040203051105200224067234140110055082142107240161175248058104084120142038077155026105124007021210069119142209104061244175167041002179210140025128120114078061143002215040072146072164139178212248183062211052192223105116218214105251107063221059137016242053242148123122032072205126023138049017110205242237176233014153082033055097051221010243200065013102105049035094066253018201033239070143098112164092055075080009096233066059089036090119182231178021083039063198149123238208144219123047013162002140189208237070021014136026220121242154174096102045131211194089161151046214093204129204080228218131126042176014238114199145109195011074044189093045163143236021145104010247186056250134132157164125129026067065080217108082058070033225187028112026098068143160108232185241050006091217207040248117042084232175061083129137175098047207230193177058190153216220208198253060045221052247085128168111012241091181206228117214214084093068099220097078057165207163224041161197055017249219053051026231119230175120034241106154192156020078246166111074182140027034078182102075184135019241123053098163015131206081234066116035193243154248186176016200027031253009243124078101172028075056102136077006024194046068210216238132059180138142184005025111105188093007166161212052093125106216243222223012052158094217058136181014070024022131218052091204253074057048063193204067064014221184164136136113215062186224192043228187013239141106043041115072168124057248243008004242012225090187149208089111205231120183050058255012238094196075057067248088182024070190158029032177031236161023237065049189037094220060007008089117167152048222183039222107018087159053074009213114064131094119172118126165031145034249180195182114077146238076229018070068027053053096065116013140198210252231201125149246237230065198178108057241152246070191030058174113126242247151113238051129108212164081200070198059242060012127202048190215092176126142029173230011127164055175248196154212177142250101140189119187005175172055231211055178106041124056002092169220251240216229235197028253057239032003124176187107011197174232082051113065157223020048021084191059033097016130023243007180143156232158048030053151101195056110079094167184109088187152062091133142045241230152125201244199117209159023235254007159105118094138224002254012238203225036009134156110184010008042153231247057243068003202225054192011125096093235203209095162022199251102132129192047009082241129040083106166011204015174152249209145170239079213126200169128148248215057050087226211173043051221064239106074167055046016159196044254084175009031250042095104145056137226017073233100048043087246078252036211140223105236134135105224053215052167013104071182151251240220141047151203239077190075122091089220140044059222158016129221059221226177041201245224251150016099038104157029162083127238080134071107198170108078212056021147045221225070043109036157208141121110006151081169124248170148057104137066017156106075222212254070223078011205072092135089182172021031227236073249143076243141069102098117071097218233081090198042006076044022100026003073077166117237039028096060236193201109083081190238158016229238163137231121199165042254019071216163144017217211143075124121206159036082116072020129078002013193003117235117246179147220087135253032016209127003227055201035058152183016095076161217252159218124041073246020019070088020111242205176040069176163011121069234086239169018209092241070182101112031163244030219100050083223093212169113110186022198129092213208236161052135042218190152183032056050253007206034202235217057061043183081117056085216103054252183219100107176038213042087135003182141194207111053244170115007197165131182133019106068132136090143044042016168165003138121202071178091154157007068125101185179091217235045241089182075127177190096062217146222145184037175207023195146244055199249106099167083186230234074203169221082235014211228139161170041146026161250146061203105146123149202125210223105117035057012122247228248239240148224231195124179227081009111215026181189141163151125252098253220035077211033022029057119041066227193122173113048144220055131216133035052074095088146037169034212161202018134067058217224082063128204114238039122073174199047209140024175183219017133240196031162143059254076203174117224062062098136237215122078179190229031218134226092246026122097198192166224156042083229027208164199035109015160229120213114034073100185242008248175033084232252200180130039050246126134106087125094133133024199151162042112046026176052092156004068168178114083234228082019032174197032134137008061090124187083066121237230095190080220244125130253073147242018097193066209190181077159144213009253132172151159176162217020049028215074246184226154185194068128026149044077192185070096137171179147187015053082247223059243138212156169008036225202017186243120143141118104229147140251029203009037112028179028254088186113157065088011182147085251247066010164159019244134254239119176113192083192220238243242073162115232136179200190240092159106182072131042089110051091132106233078092025169058082210182245014051010099094198139179115032089169107180052133158238080152161107014238168096064053234064161023223152046176147045089186125226031210009096048089110215137171004081073213152028118125022110233235188178082183046154205193018233059057092016107057139158077187204231013208147015162037129195135063221071201255065141053175043132016147249074220111233031180206017034132189180173172091232200129034033221009143112026245012044059195187154238179150120147187147201087218143043101022013015209116175042215212147047119241235021130028078177150176183148013166243056155024028185228238006059211211174008128173143011145079237212209097107063072113079094170099032155115110179080145114111004028065105200129114131135171028055141243090063211070033137086245014056033229015242155242178122225089203226045250192130251012027025012059205192063016226202052245180217159183237197127149214234009215185166116013213036122138055137143069003089017060045048017056200031250221209096192023243214132143135074050004226009178043071139133047237224088060117152177188179210123130146123248106049094033033032168048151051159168237034158243157232181238083216119052106155194132123103160192112039075063142171204045174080043211207061014111066248149152126170146060201187093173103044087022024131234075036138217188213028189078128200201222045122114164039053130002048085226033005031194148084041215166128018122080198221250033127013152239237010230006033211098091215013101008154253241147180065224125087228150041240106190120082095240008064232213187022182028059052130172122236035098032095056131152005206230246125241204058076154080144112153216127193014189190094138065153119037183133118101183128033244146087061238247121061177006009170152003209090112044008136125186060009043197120083128098165218040090229016247253202125132163232017124002137074045018222068213124180228176247186049062014045004042133130149068162212108211027030035192231112165164057122217183017043102123151245171127046107045017081224155217157050043017229217246117227021048056195189226035195114024049243084176181070129160233200127239152020199183244016090225168244009218122183213052218146252184094103254018092101236152026097158153236156031105228218017194163192086160223130101043249157012207058144199227210085160148013005123250010172102142072108062096211094153073188066020049024015037035045114134056253181250115117202169138089128124149177096049067115255151243194056167151197250018033136216072162211208071176214174036024027219134200196037011104106058068220174195074204069153087039181107146231242137250232066231058024214140204078181051160032009251083095153215060194199219147128230199078244201246150090006114030019201019197185189209060011177194034198162006077097105222245053102198235153202023032132251026249135057194222163125093065231163020011210251175033188034086232246207160146104050027037078206005063080237208004241208126231035020173124009255058098046028002174068073096042078238077030106064156099120057141105088117004002063109151169101109254025111234141035170175236119218095148034174074140024095131102232079195011194213206028084077029201072237074061189071094191160200086060158126092139251003203006196234249140243168026203014057100224091253066087118108181199116142024150048157087088024141053037030093025033103154085053026005169206145061181070208031214017076027116026092092162170039086153025251037246075220193035180007187016184045148231040212188046150034090211130009044244010231082230149250020077238245136181224094016075225137074155150209016083178077113196029026154207022162066075239114102213051006229211232091006052159254024217088158221212185096097099201032226240020097175206014217096115059009212169240166109015199051109162249031019161103217059180022169136007241046254065132187069004096011021052151072022052115122107134198178121083075199154084170200137041240224124050229249034064093235058143002087020229082196025149216117024141252172036254229163056030252046137011039116249074196250068123002203231254113149182237048119187020041046013182005197184231212008225135113077154152204223099015021157128215063086096184062120076087200110125197033202004146003189105232250227044163025130236106003222150129131205161037143184184153241189143085078173066120183207014074167152033220142025208086116075010071130115006046063169069020177228148146105189090158159251114057073244112026253143176223015140213052216203108090219002051216129101221104241148061231251250247096190005091228201110004176249145050180222237078230024141138213142092113103236075078230085205086206031039152248095047170009206200176153061033110009170155249192068049068088093077096076174100211216167131005171098165121170124071205177051167203109189225221032096093154157126012162191247121177154071064030121108101049232039112249126064079221037238155157005159178022243180147216005019156148024155194048204016032171223116019043211163033106140235202005027158204120068019050201149162021247017154247182048004103237037081165182210135132098097039059026033141017071060229099237044105195239122209118083125042163128018159021040233042166190059060078207040235109157157038191082112071022176234189246070252091006156141045084005054185235188237134167074114102138085130140141140089220129189038009209144222108017099027161186129069253046042014193104040071052251069132208124194019161179085118145222008116172083244205159020178075177017140026022068186063116016186007121252219020078132052020081142212220244023165133083075050143066094128032037108177176078014228209123060085131030201246066207059007165151224043118193075136064160202054124114061159198058005225147229169247102188009139148212014036019248079044232027227087107164195186140025183089115098113002076183023041199035191044003133053084172130167008028122075038091030167212032192077175145171033227082060238064214075076236243023190114241069024064168175197205194106169103106141166214217044074199247129115158010129093170023182120151017194008076173110178151172121248211091191095161155138058068208098169229224023114117058019215147197023211248077146116172174071186151089037108053119097011123100168112005226088237033160134061096094123233171224043068201101083213140044184069213057228109120022152074213127125224046103245015138085051191059108121061108170125100036146043085204230028184136031071058151064007064213198113134175095098176228092177190006208154203007013042142229133068229061253249028028064123019057117203050042109122035201154015165078213225107069166003077189061015183039030251112067012013063027015140173044223074007232100115080152191104190144052072219092240017004017148104130014181020115181162208028105160187242249082049230014018064254187145163006252161019135105190158021097183221235043069134181130239065239164056056027025036083163148055034112020217133199023018160035176080076239083201221102225109069108036210070167250012060161019111162168240213162234115063172078236032028142222160081243036123021104089217103006174161125124038099186122214033062077117144106191028085029098248042005058122218011149016112251162220191025115023024178224017196137144044198034119007234032019113221227058004117087050207042051083155137044079070152056055145004051027157146189022216239178029219148240125233233047232121167160042042072199214205237098158108221235150137253240225062128048195239238252037027016195006003039175067129077201205013206250225109228181185174012152163086203066003151092124229087061055064093186021115037173022157084157132232127044023132025235145158143086191192100107195093168107002241023190086088058024180096100125206032252227164238012080107034129044080206204040103123214021166088176250136086225007010028018126129184091170193102169240039158007167121169137118067220068229097228119138055227133114028014191096248185078103111150098039082245014077192083041106105030016226091058048016154054065110185056155100203224101226125037156151080226164137160107248019005107237093038146200185235221246082069066147181226203036103098159170235146133235143068068194235076125222223184189011089178037004042241219249108235187042191151137145175111024206055091039241207033070036017085135190035166236160243126116222151106052173117084213250161007149247115192238043094202026101069072110231013026170027215235085214145133163197098057102174185070183238138195090252184106222073045036250141137197037102120195081083086167151090200235134082116037201029063221217074204226016125109049027116241052207050027062195149202029051064055010131156064010041090062169042152125199116074194016105009111249082068159243034093098172159252050028242075180157173130094026071208244121035231164155201080014065204091252118047015098107229085022100083174024087068210015134079008178213046102016148038240191203119050223018165125095185197020230229084059136212099180254220080183015178011203049057051114193101101160211138071251094111251247177177231023209129188188186036015152193128181181133136171177235195142223130111226205128227008086121072221242107184177137074197232029168225173208007212132186135044057250106227182202193028027107028087060057002132096217072050168095158100173144099029164020148118027020151050107129046086209094254028047058205104152212244083182030218108092019093027149119170231114129140018162096043066098104209073184190009045212230080042008025115163025164044110206221133012164011166130125040024180209011015052170107119012029213040102198250093254016042188240046216090149148108024225094051119175142012164242052202033203111212002107067061030015062054212191120067074019174039080219233054079091123198152237248182166110165253039120109253002253085228066011211215166207064206038167110114188126173058167101126187228066151192180049225194252135132013031098043252010215041189107082240251194147103105171103107051046068157132129188076126024079167071126180099127157049053029133169184113230181116145022040194002129150023230206059087021131032244104164019005009177147140200111203096219035131094160191080080054138078147031056139038106018044122009079125226254183207031158118207237237013041160161157179151064200209005242177052151107048193199050169033143210026017094164140102209138114008110211114106088115211098203215045037011105141242162086175205034208015086220114095080229242017127040207220166230230158185109151107155230087132051204062012016253125095008002212058094217088232029245205026209236232044119048093133118250095212186009247116030236148036102233120156245084177132112216107161040077125235096192010178199030156044236185149223028200022239185140183186027248058226208020100165248207062013002203235052112168216134020086230045087025154068174058137102183226248124002062206072073002163073023029117083108171097043059025138029008164226134063012158137203211026059242249031226254079190003176056068156187186177231042118007183082021171047002098233026115157042254188186098204017144218252122120201249253118109103219243210253038070097035053019137153245153157198010081100240171145214107105125025061047052146069168193041117069232020019051161208076201031011199253017177225144199242137059033108246068245084124116028202179240174153020237161248090121091108017222009035132060054188117085056202188047135174153051079208135037221172032176006094020119149120186211042230172144050005229244055126176064088171045140249045240107147120112137007027089102240118011005224105170195122183198203110100156068132104154196205091016095019038247109077223095229152127059160016190007152095161248087074111115200184112186237170239024053231226063040154231193076102228049076190163054179110088087016202090025146054188153166177211049127236081085178066088181232189126122074031224227079209054057021219049054120048105159215246237185143134008091171087053032089246058254037175157075091125076080251154061021041012025191002009253121241153002215247122133219217037254213197131132205106202054173042174214011171158029153117146017127073240125102083076105139251139002103058230138196079207220121004172147115031213099060008111182107023054097255057242062252114028119244209175205203233162075133212242146069225121151052089071204229246242085055204023092146231092105235151137037109120035198200190062254174095084254227144076157172126065020028169178099073122142121204134092211014027074113229076124209095026019218027022053062180176111146098011197036138145189046136013235074097144154204167153216113031109181011127045058089253113178237236198050126173022013241024151208238232046099017039190126086154016037226006238089230199119189191161250070052094206085044190242179164180156155231135082174071213207098049110208141009094136189042180130088029161104113026044163043173187078199002245161118218106035182001172132223024020026252197004079029213018251174040083069239127117076070243073075040033216197035102200089052176121183161253229117097174021221152181191076253142081092162113055252112123212189095146063140060144233084126024236013225120096236193034232249182152065221109113007150088184050066016074102242048147153057134139148036017052102190072156098055188213005014025048201016020101041226206217088116234199178162114193093125206183064176066194228125116091171058020095225090117173087014228068072245003006054150093172159120141035122050048033231078252018088174167118082174137225034060088231016079209232064063051237065140108122048015167016228037036151109073037175011060146091250215043084051051070037112120239054192115104185233065075173010236004117076044146177173140223248034253057165158179111123034069056100064064032112148180081104120030085210154105071107008134040212205161145067097163088230040182173192199217020076089236088165212160218159204195201157035225107201210005135114006255124003115202206122150252038023046251201184140021159019075128026074215040188189029150178237134185197048053035026134004029132021228146105116040045150071020171238237183085007026186045066007198113038072073099183080213022051146218137078187060075210043005243033213020185113046184062215072239215202223195217098239126168131049152082185248131143126155242199208197087249079161106252002088015212076032169036238195232145198229208129147089231225058093005073205106090049148182090205175236007245164008187116124203197124183053231026176213058118063219195107127148184091152061172029134125133087102162137170206241072007225247217139115236115044031210102250142158213010199225246148024250081056074147088124149040234078102065241092057077064071193191066046093066171254054019031163123217232026009205222195116056176147068065153136049176184106052030239076157210246169226153162122206096039149040100041044095078055116233086056206068230073068250095233033012053183248006078126168193241236222023053110221203013244090006222133164163033018078038224097200198043091205135209133059158124107216090221205048114131146204007224127101074251227249002031141159139033094112113125141185139059229243224191200100042135175095097138248019118044087095168035225118233026159215176042061235102178122206013076043020065232183218049238082124243129043225186022143089118103090040177170015126108074062033047112063039052253220223210230228047104043236231177070125034145211206213092173081011097232156021056147022009012079077234220172181016073105119076129238197116127125010236075237190052168124074244055066046076101015176243034008254226051060087234168140116235122097189019075086111247122240092204175191109142103050061174008108181062189226083195101114210088033045240090239143064164140249023190163126106209130116235146111088239043210137180103100252107136110063210071209064134131148063110218210081096132032102116228145248164136122229023048097089095214126026230018130068083118007045125120243038033061165066212239074074073029086165245185240163157110123185031121111134154108085235097015240023148212170001026130090202167086160235223016243210179085023040129216076125227077141035069142211011141203237172126058141140008220044223042059198248083104104043203069066221155132048142103196128020228180086118081243129220106085165109089147219210042060146030183139248083158161194154186076249020004072240249033052160158084234016058139066213026025087172253068017206053028044203238088198154154027115012196073077208224035005023197137073185166228048050076143208003052213178205037098097139068082161164097194124125170072216034235177008060240089053207054193062215146107122019093226145174094136118188251029023138186100033089177221144028066127047023060176098220216073109157245149103157068157100159178160223231040021128113211011253197046244197074124141165165028246189075063141096056154090217031039209015084095244243004230077013042239109209071067007032179135100246059117127195131015187007166173129159174006010184013109142253142232090094183222124239214035080170018159088015085235067043175085240044162098231077131068007220123083076128026134170044218066081251068216058219007150072177025009168135117250076052142105080237179103031141205204062106017221062210093041229241238196134083121234105029012033197015162114064175254057214142208222182137163110190133157032088097072169117006036069033051024131174224054103061247117250169235141119176060014240077232218252163028255211101247011120135086247011208193122202118083128046184155052154051027011025229018084223130085126178167053007016109166199135145091096007040082111239110166052180035229062217244191068140003144118226135145070047138149009131023224054152103253053222139053133008066165188114150247207086227143175013084034147211111132002055112035190013166171168064098148196106055155210213037154225070152146176023226244105101178241247210188089107101007077018013057251122012043228132046086163083157182012100123159126061199162022056004065020105103118204126048096212132052249068206185145064245119151073111150240173081210170131167212103028221111005155150217241197176183045199017191116090251246041002048213187082014083227087132083072119053038150214104179216237117028027143160185061127204182208075205243247157135144019208026156048081068053158023072089118125254247032214019080225021110189157136248029060059133002182206107123059199085136038131063037218004242212215020164236223101171114054182007168038010018207105117140108118194032076015168091179028183148035140101179141034026220089086212122169246036052247203028139073051116104135226161011003035136070085241121081159229087136013053247215086241096096070081101095230232028036011073170198153087062111160028123011093084044108024096148003031046114198104155189246199083106169121193079117123016017165227008181194133234012186058225222185235098132008060199122050081128075162137068249196081138113234036145172121108205239018048037227151243013164156213111059106131246033190002156100052026014075176228168071124070124034123165221035005127192249062112005232207063173178048148217170215087080099224077226039080080224186053101219097115131019115055015170156222196175203031099252180225081173088005108116033101125029061068149206099174231034108217144065073031233129217233032049146152062128181200243097057012054098046058009092129246144072217019005035132080013075160160197243035048004160153063008224085120226171124180218212128186067196133186055196103097164093040048124113057239125245006084194182181155193204206127244241056163239172143176089006055109013013183239239118223198192002060083054201075181164191087221214148179202066120206135219247120239063096222110057057084213175026231036202235182179160222027144134194009149083025146248077036198165030162183012118059170119103196145169034034124097242175002179227020053166092005201166226064085102128100099230162018087046121240155184038076225211006163130158119061014023240254053178252101156088034174024246106241095072183118017042197005160111049250174153132192050044254176110070081233047125094072124032024003246191168068159121028176118162061043214049009007140050219153254222126083075132092225038163044097147096187050181006167192071175225247037050125124106009133134227143210180184015213189029056094153054076252105047020019011066225180005128110032097017240151177208182034189205099102036013217245153119026234249220136116036087107218175197203143051185067234246069080066152223143011005054014188153089058093011144196208199148177012077041070149184185051171027229056017138204242239144208055089207135069109151152038210116146086078083027125128218076012053007190093105054247185083163155011134085015052099049058089236136164113045189132113095038028121146106235050236114094157081179053037152085075111188062148217133051184220118123231089048254041109252077049086046173101114053043027240041176130164059061102197140229253043166144221206154125180147227153065110212113190032030164040003188149002098194127044070144060039191249033037212222237158037100220062190104017159107185183251005237205143251149144164180026003142223170198098059042035185083170148171249063160144213253106010153231245002161211048015233036120180079249076197045120061207132114116164234040162201042120098202123245074138005148089145022149135186038149106204149120065253097106105167178247028186011038057233217147084205102125084215048231073133160145018081142025242134201209049199080153226062044108192210094071198174171101013214245074196135076173046084189052241206070173150107244141051051023108066189154007051053048246076044150197185006002029063226172242213032206099120051152042014050153182092108201007152203164125035054136117235174147100255165050009041154087041236101008225174230198189002097005165065072104239109037123068209149107144146030050211134244197012033199254131153132147191242223089147239153009032102109224025170034087016038200254146086246197089168217210033151071054027010194047099060088071037175159246142118255127232086008148112240096070250235189192161132143026085116116031189042226118244241068191094080088229157239149020187246139171031014198112057013251201073071057156025066161091013047021186242085004110230116106196159062209032081234120009211185001169083199143176129232220232059106148165032111221207143074002222156171252140058052015031066171107075060044196113070104214182059078009231226143031005254239231027063009103175250246150085018023120195222176026087224008002055059176038221253046002211052154007061101096002224053238018252110131206128252249138212159175214172024161133180159163079236213245087053238004179024035094234083020042051248174017025158110189152075235175104205229009017033049234078124221006050018110102083022111067104074095210090109035244077229108015141007160008109135057109202163091060063097002231200093213098053098093013232022238009029121050186124020024219104081166133025168113067041128247233223015130140120013229066187012090068235092029187086149228176054214120091112113201119142017052071036181203124240196160052101079188127118101248060052165198242198015214127221175090038081024031081091046157082110038127150132059025083092085253105252143030012057137239116020251004180229041012089151013251050043075206206182148216252232207010053143138234194078136145203030175166129027039218194187005086239163155022226193054210031013159179165144049110034221195153224072038079184175153174088231181216220222002155003054215027026002228111007027200145028006248193149230196024115035199101003008094154149150187228059098231157166103130008202099215161104039117004024178063196073052067040137016095108194253110188058123130041209211221238204073054206163159253113026081233223173041203182117220148075026054230115224233125125055081067070088103249095202124202202234045238083140053173156016121134063213095094065248091173229180136101004209104122233101153142203185067175073155018208184033157230057091030253115240137100236015134013107160019194093125157126032085022101167129107185214008235152215181234016035184031122024141248213170201184117139054186081093241136212061215180206115232211006078189071199216215063182193048019161185106181076221116241210070021007056153078075065198189015068071003005003127097195055121175081150015166015053112080209063226250133159181252245015220148200101124044135122224144156028010005121184118244194164205009217245210141136224183014029018068078239167103219080251034116060085120016021052088219018226150106204067176032177138244065156141025157017125077125171237181156123152106246079085150217177222175128075138228023137030069109006164062068100100145063230185181157009164082084140210088156149118018252145192007080104225092242136219142096098127012079156224146150010153196113062223215159046076126114253012249085141211154060029045064163123144238149108061199169050123125073178084205239078052048170244055106094114085213146142004029015009252166072246205123110099089064076217245095095224032217126202171043241158006046141206089106170249241047175125066193225180062149175223153240147097205255021207009089149198222067228231026123026242248195084145136142210019121217103028140076065026163080063157182164126126128056047226062149240180082007118157252039111186197047180111061003110100007166030056034057052202166254142150116238218129014237024111191008033148246064029173050246165104095187089074126253168219158104144061062245136176154049208124197052084233043210020249193008117232021221128049039170150078103181095181136086028002192230010197020163065022212173007094202245228148159034088009112246033208115110095052194038174049228085001197211044002136172041102127065160232053160081031220113068204095165185179015129187169026201058252057182235077177211095142189151089046214072006009245202078162200116064157008236018088140149184020204210173163017254185011034241212128099128239078154081043231013063116009067139146028076160217202202182134046093176133051086114220032141190229062104045071241113034145129232069075124097136233137047207162148060019081199148217137067163153078019239206083178216203178139092052122024074229074163242070245236006151134112144108007242183030163047095185137025159047243063046038118202045136015096205005226104117033089136230076197118139200154141142084148106245173195191091160086182154160046154017068025049237123242153209146096027168246164001242207060102056193050236251149239174236191229211148091114132025013046121175167236161051201118173019092166030222127133002005140245172228191010081091111196113041223232045168115196026166022123063150076065004180145096145028019124104199209176137142141036219166196146227012100082151088185148054084075102022110236193013030071071088116170046075039122215166234143182181247056115236035248179149163111105078203136171228198230048108155035020254232085141112175030226093145238124031055106206239106114240195216207246229226016229038234107128056215052074218078044216157044012202056060135077105158183099134075061210183185216233157252010243252107013166236067135171162069062138139229167087128036209052025148093093018138165156150027176234194190018018143119096120049021148064074066190123170095138051143191024084154142105026012113247240089181219215086232062204114011014019068008024071118204136031234198008068223255250048106107075105163194170047232017246017158048212195151103229016152106253116065049231004106028071053103216206176118141004164252035255068031167130022019081130016012005162082164090147195098223068082109117004110114230053170010171245195169198230190163099115135112088060134108066154244055083186248169022187021197172141038249099181149201025178200088067014064057060105027148067090181208180078244150074006088073243067026166205040137169149198150184020081052206047197183025099235225110037223143060137229206240073022087214113214107076067116253111246050156213229119019132106049040254182212072065094100193141143201059232213251085129074001010243107157111132251060185162063110079115178159065200238086048148094249111110206254151050182073202081026026139170062002083220136231201046156206175138253111118110168101084095077014246009225205047225125122067098093078145005012224211048029055197072170145034191018059003033002022175199042127197076218120171002250031088054098039102062085090206104043142141041102007185100158117217021228248058037174254103091169142247197137096169056115002049113200026186241063222140118056060236200099064231130061071123099090073226206058071243147246178173227181071055220146247202218081118124131081014194124215142170004097206204214060132089201104056253048014005040006059010224056186210083016172089186057179072088219206225062040107207105023062063251044208039236107020246129019211041241144060213187132206204189109236240151009013173202012041149114111093072157240113203210035062212100190048096241097010192033176162230063126156176036095247145043140148140176243248004182002202078129172245054085175179027047152099158087181119024162029019192061002015082176090157246107100068011134231223210196198245219208075243007120103129199201154174243144139040150071099140231076193143018087189051043016232092053247186237058109207226065207180076102144045036066074096085120019041096092051203143051126218024182186191029252097013102030091229002053198032063109026014122245128039105235071185063231236205009106189151096133032072180042082127135104107110016252032219176042050243179050158118018012143116234188188157027130037251242055010111129196040184128082154224108095176031018009168048023066242232033243100123214103058170017122221073035247163208071102250194230152078106181102249149223019178064150172198114025044029204027048032248217125139199095033134025220118036134184126112199111112193114104112024131246036013177141192235097232077242142223051200186036044048106238068070058195060039135216087197196070203068084208235156052149211149181225052190248119156223209193250105240210123039010237021241232230141162128035128192025233138112170008081054130173007230037059057048214244227234166126150115171046012155232211093117045205203097012140250046226033105038201004198162216225074101091115083049120003185080221236233187086223024177091170096199018060104068244253110110070060014148034013071117127003016242129108105139125114240133066088152222028216225150050166189049169076049031159041114178243054046048126082127244006152226233040115002059234064210093101062154242054145208170151116249162142217045252114058117175069157073250226029103251117012074207125083119121131235120163177011051182113034049229015038132099192034077141237184034146071228148130028197181231221007023019188037008085032074077098129068093149073154107186247198049039222202099187115011210081020149029060188191164227048177108069148160201049138122103244189114116135111010168167075114092095082156018242058026133237242053139112061036051205064197053255026081178158106138211208078249175142087148211032167194255240102207163106200198144150083005129224087191030170026119171233213212084141062083139093245201028232125076212079138027217113225034112113067194166207115151198141109035074233065160057156077153004159210058011134213244077064211152102061244240013034150151202109244250071073169074080233045171015187215200126233169036018151182216246078098021056119162183130043106080147165059044134165099179069231093098230083076170187006168009031132034178050192178097182098243005223073095128070227196089034094049044102077134084175131185051135118003161109028236024225029245148115235156170164227016169173059137077072091230129254053183072107014162166100135145128145207080069047180154043081038248089123176188008190193078240056039126100068211094234131102061056111134233237042101180081012046172137132223251043215177082017087118191136055166202254209056099236006233039029212230084174207094180086092076194078212038249111076052137045236080249042042219079106002109116074048025238022251082066072074065214224149145180176237218204187013057173157022164189002167095161197103246097191033002148068053184175058027135092139221100064247099153222054132179134103011164253239074190099184204036035230147168247174237115151171067247156159161044219128051148136132065185112086235221085196221118133094206111040132094061016064241016205035193058201246079215235082140224190084060207195215091016020094012145021052140176004166072139005244250139038136103099033087051110174067225029120167047060154208057054050192127233119017178059206208092225069191220015010215242163238107226122158009096235250136233125200230152126212232127246107176253139163190153142160227027126173082009029021010030005194072100251013115240201212013203082116228013001244164120006131236067207201096062084198090011037018143207096143061148044053221002184011200226140014077101028066145030114139098127102081115069236083119208066098158161054141016106161114179115061140198127025201077033118001124221126199113234070241225134021025103184158239156150003218151230086166184159004147146193220026098091248244140101254018157163022071067179181070229162037250221146018144088120096230233092236187103101198252031205058094111119088132082248226169145171247105057212172110143043097242133061215253133144175248110137116158029035134018122099208249186192243111228223082149160088144127068178083165003203116103078127134254054222017253040250185130147222193183248208096194120222112169091214148080004201167249222205206078254126241160229091231093206208031004085183110152113009025181007136077156146041172216024183179082029101229039165103045039253082161185172077034063105029160107023206117033131070105209043035050068091016146018017096100230159127245230149198123077137136155054185150138010044135214212090083142172109147162047146233191140202164116126218102066181116107019132041128180191162124133043113103034160068209245005242069222185155019251110048230238219088029112028092174195044052048139021188029024241196153091136066005133171185053082130238091221229082069063121026088106169075065200050027063181004248134172140242168056149137211231082149063091084214133247094042119232005203041219213144051132204009159243010245211191067228230014241089042210125244070194064183007225056138173233186192037083227119022119162021216223039145180191110218245191152109095186130057073073097207134176013056186209129194138057112029111118069008048131084070150051246215016251235032107035089222246122096252131230168091165144104131192140125040238165184039061166016056086211197249131166189238196020032073042183254183118070195174139058018145058078201186057128021025254204167221172224189052038108185102226168098069218158221200162090185048157199124076004002220065003041238072090044230124188219089246131061181118131197097175041147044091244243112048128106207072075050110248011189136102142198193104181214146241042199020091051114091144039124042024077054178155069065134014172201149198035100114120115244247246129094095068018030096078250074203041211135186047073205136145012186071190196198074153016157106219073185213018095031176076178227167138153228247057211199198179221189042196152049136021250167135015025148042076248019014188219105082076006233006070204228134106054164219188229154069095251048106067091069225208207143242240226043070108008179179140096236111210224057244250207181092199163124208195019136053122205246157004050137083204096061155046078184243209235161048152099094196166159227044125145114241184175136119024182117068094064048033190056054227091007064237245223136079106119083048010195180064110050115186131131145214228167057227193120030117047213063077154042082165253128071215197116033074021018174006150070201043099191229032113035191044203089248113079201183125200124216111184054038082135190017084195138187022048056138241009037128154201126166156173182232155089047205041124051141146164111095123204106251150132112100070225007021244011150043023113243254149244038183241029229152112054176164054071221144016233206171125196076136163191221066047164004164049160102046025141195082142150209225087077206080118172042127212146083188108058015089255224149193048022072111053186233026095065189171254039002003049233188040223216146090035023193079190022141131128048227044017090188052224120099150020204187142156055086077123222032003166119052214069032005092075150159011149172099160059226224015066126097014249036028244089230079090187034005243217199233217057119187211101192044238229063063119021112246043066011030161138229003139019129089034173229201148121154199078104163125202201066034249243143095092017134097153124007235015169103012250201072053147196039196229247177168231085075254217008112138181063165028192022182198145015094008058044079019062056108043171015213118139021236118227144169150204149012050184124206083248219179151126100136209087028085076178131037051091240010072222231158167022050106116227027105243008074103159089158077041191242145031242225064013020127061085219053215211150051100110110008186054141039029240188102146040037008141152041154246137192194096061217192046100019167150080061055184006062124163082053182182236163241160145094104126088102056123115063179037066254155037198081239063156219041116128188039162149067168253150002120178009017229052117002037235024111202148205240140007160241210122202044188075246167232137163168036174103196074129235079035146223071071146092205177024091144086060186188067120117141197158017114011027118140204080010213049093112181208155013114120229115149066048238008038112075038080085005192081157219094038148136236024254217057010197205157163180230149135250002145104007129215171249174255095079182152242233047166003113211133210030231249131017237124127014100004110250166121236188134151094210235113227006012138026085145097241069112162128151025078152185146193059248039225026026250077009152051022094090227219193088061028138204222178068220011035168090229126157113070147111062146036089057115070010121174018076216020206102049210135140030206069057115152081166239193230219119068192181008084015130193005236122133170041085100238167038172198064111185220147114206220110244082088053109091219214123176074113050204126183048203114176104214161204200054113090079091149108213209134094094185230156155080062100004146128226058114202183031105179234134210136228203237216129219140067219091211024143024104051251237067034074115139126162104249079034081019147057085028091177145104142190049008048166134069053147037123246254100186065101211078103019128113139012212040011134183137218228007235149196024015152038134234161093253022046251121245027067201239093055073008234082193076184033124204052137004241050084176108100049005180039226032051139105164206157230159190198030021219066115037153233007170252093030145116147170026255006082030129192003106229087191134099065058221181022162206051178211057083120073085166118163112082253121046166159202058038187151105008089102230076089038088126134130112214191117205205183118105021094021114075084070249234106066023044164099055090076217032249254119061176198240066043138127073021192022211245135196202108120082060106068136035239045115183165138070193082021051118200254119188037204082131066192067132222116195003080167043240139249122225107212199218121069054128088039123247246234210201213246198255200193229239100119043228047160036070094022217221195090035191251144085042220182046093142249174206133093043133200135226028217105092129042192013175196172046160094035188182211058007126232004245102224126060034015087030170218136171031202108181041193250254033029042208184035242162070041039108006087189030030219091161158015196032118205242180018119022082147155199206237140243098082245055110009210187233046058061060253222195200034193008066179172026157078119219063131087243008197130035138166249032184096123187101144198008188221137254242082230184025207073100004054101061224077233248060157075095211101018127089131219069181009252044171108060070195122075254110085042028210101141102143081031215148206117114002250174239052009087227249233096025025065093056130167220195017090073058143137166141250190201132055043141111198062111042017219064007212155130216224088039145164015238168115253008227167126096016085064219049039113220088059165112065217237219120104096045198038245008172148183021131132125115007052238196023131006181028145247223063106073254175062008143239219039031038003157031085205008222199086146029163087149029083006035137140180021078157154138112109015170233067243021206060247095118083185143064011242067201119060022041052229185197076094136147206092117034101253018061029241015051066237239099057117050121068183179125036098010073156032045164238117183140093221186071042021013162078238052172233055130246169064159132223188130112132051207076085050233032041158233073219208240154107019241086218156159137165015121080124025250185084103081013249031159079238026205020113154147127249186113168078099199131044038051112186159230247003032107082244208052187002199045080076209121199239068205055074174138051215050156112218196139222051205232083246085170234051105146249243220222228178246254109069158192025043177009123065105211214002092215110034118047057138156216178036231004212053039248046012033159010014184123125055032237043042197087234185111073109254248231243138107067134100074024103190191231190216188007164129168065195167078069205230179172177009029049143125086232092027184173105166121035130029206248042193196032028002069115195010161107119203080090073154253223123033086076096138133157144244049132095021073191070058085033209075091047189002207126247012021099091040208187032198114004190188065083199251245083123176044227185136015171252123084067066017057117147154027137155016234219075050217086113052139238126220180226071177231093148100081114021167165063064184119126221085014177135181146117140245219145250224127042018109182222167049089231055114102211071068132064079143084145224193140128222073207126069241006043183084183193198077091012171109091246069052187234145254073025123098197170108182238027174191063189083227132200047210204220199054138201152060185251177005188063040045059134134209106043123046138245254013034250022044090041147146207143192042254069115229153115229062018230053190063241040226180252120147113153252225032050126069062191063078044040018020172236252184153181226062125198079020176246236192008116092110007143197059040151075032245130242203186231180220020177086081145234054181139135209251012174034019185247099184061025070178094050026005212101202086198003182217176016164081194123214136142198110027036127072078159201145081253124075041160210175073085153212236252171107015151125155140121222184086076159250005130037215059151033251182014129111108211086070180170213057047188083054103032065159189197106248179081017067065114183116024029202240057252016135204247008093210203149115249129204034051244141087205094171252030160030179172016249064183146155163137151063167182238225042118104195067091182136218091116176024162040137116109018128077133101221181188178013203078135133173228110109005038006197013205070138057034123195254007071233053194068234151077092041202084171133042231092047080008183109066054132210005068178218098236176075202140162144002078041249208021120008226249179035022177251060122190070011155144153066193040100041050232170010014142199121081164234034097017014025217083020020239068094056009176194045033251131138154090057055150110006059183025053046205009236050166252112046223003025087083013190234082124017068250062104103039197142197194049200103179116102089017196143223212151082127187008021075109238182047204071244249152134028152254024030069247032181185010030198143212203249163217113143085121033226137003206141020137164067113064124122117252014043201209246016129219090150130056215165021240187006088236205041204192122157252182246169126120226125229153139011194149114066087141235004106090171249174093132207129121142048166077206027122069162028032251066163206148060059101128079073086114170077037219212060185076220087005162142215162033082118103241043244033111117224196009174025044135114094153057089249016124204080252155240029227077173113171024170190172121236105241246066232086028059204168088011096007209103211079122127179195213147187245160017039206043028110076170212123047028119014152227235042077112060163076015027189210194216221107034111125236159038103097199210145077024212132146246053057055223112174064152252147084008041125137157238192127138149176102087230008095071009217135102177241120153144133041031023223214083029024058017056223094096063137162036111073233020046080010120099247220037196185050068214196017174176062054164152040019240142122212105062120051105116219110106038108242135058056103017038095247069011181075163008141166111048245116066236024055056061034037225056127085083138252040064073166193167031159094247136160178221139117077202106172038027248088090208234208248250106166021131186198067114163115240124135011178006197059117190118100091149191085107038193029019159103196036216183228097183161058206093165201146044214004119239219183048192069157181046004245088246092187117091020060013007004082034086059090014048027154242055023038105196087096222198046188171185186076145218065216201059127030080136028133181043240049074009253054191196099206142109074250098002244229206236048180089112027182087251160164186108103141159116074243227161041067238038098216050178208213093070011009150015184222202208218100104166192019128048062230091251136218198035035147089206057227157089133121011109003214015130189245109069154222055017181108034154018216099125028121140114091102052020128183231062172212036124074145180127018069080163206117008086244085115087219187071062242169118165251035119244012105164100031033234189250195224181227212026166179004085184134105166162245136035140215106188141084220233069198112220017247046173196083111086092075022017115174145012216026090169174080196190123036050200157122222150087119029122062188100125148216144197085091032058020246234195139104017153009196181209011216051219010037048215068017197251061073012228055034009171244140250013043219045002202254241181136047037151156111235125010153113130173041185220062010087124060136010143154134054061100053151157020052133089031067116170175168030209217075199011078185077221185070107236198231115033057195160080071194079083145095232138218209202105066051253129221124213018033044067209162237175212122038113240152038032022008117058015108153047230025227081242032205115171152015095178246227065070055219057158157067031160210202164195183116049234015186172123096062057214069128112111191136125067095127011155195083013132099219191122120162085168238184172064230216141031094096247111048220136119195026009169014172128020112157151236113176068045183103103091222118230159083187203135153234096175081063159231110149252171052071134223038111129089014135035247008057139202102067249072218156226138164064009033214005170135193060253055052014219248013008115224211210100065020033169158252065070242171124132064162205248078214027071060041043228072208114043167122075050235203048126250196049122124075117102034253126101144226153049112109005133112011023202159065040006038071207251049141162085181237228019242024239086010060035187237146122136091039046015140223037214254167222192254226110094241169159038241124025140199119043039131015236026159205203005086221102227061176194188120229015016219221021086205194061004076035196068125187021030013193088139041060116092009079127101135204148211102012217067169197015182072064135121079150211218071139078248059253169249212045152078064036008089034074059057068105093086219037176193235166045062123108042053189077149012009222167054158248073120052035080141095001055158229182203034107199114071222046190232150055026043243165115239249229247174030099205062227177121156117057207159123200031121085122234062137220216222020092153237223046253202182148043067120007129141194145108236028115126024175188124101224251170031210037205131244066154247053237165113007081209220022162008206065085044195218005062145117009232130079248192089174195058046147167086090061081217127167074214023137137009237220074163224191008203251231019115121031239085181106123239196196102236026088112240214160221044091211207232002070175171012134150031031221220001097045168190245171167010043227234238127164176151015139010195245133246148056077159235195101220184239197070005248251037123098142213160150233185078253102120188209205058089094102004203109041113165094173174196046157033248079068236047097079138188172033253157141045008178113221026244149140024210153029143144160196028112086078165171087129075248254176194026159199117208123038161078070207129247193216143059205251031247024019100053172035094002063151216104075123060137137094241111254120036151172029043231244150253237140227231026066161118095092043123155242188165004244250177157164119119147032179143120113168205234027149011132201056069172015025090052044039053033225018205006161091023032219198115017044068144190183062074059248226094232216174149167209211003205151194051190029178134080213034003022200151199096073160163084009045132129204146185250007196208027232104175016115108110198243010045070158088235141202151030161067020168153141228011222059152050167239158008133192017158019008126163191033082036178088062208101091071082044082180214239003053247092058154089104026081207239099134215188249080054213178235017104067088076049089081218209077040193156120133023109116163201202240184163007147158179208104002081022097244123028137074080084201135245221195070217144149060204033040037075244140176193073116202047173071086252071068214032127187226105202124120232019151081015034243130229031189159094228176113121052111192081104229186074171074222203026139181168254193080047100032032122184228242165241195216186134233110136227165163063240084244149052214003098232158098044007039138160228042145020043131178137243168012092236210059125022002049032196214089190075150059101010071217206184113233084060142236033167138249187157228156210080059048243106078254139164065074109075120061111188149123249242065194215015080247151046063156249023141093010063120144016102240252203012171109077052167043061174040100061238215089113200099094145007083182063047204108003219100026006245008107251245123186167135095183175130207050201065127236064057027221110071052124255220133043250110173061248050094240047100036222069026102113159106205029222215239024246166045086202015071205245122225227208191070024055050207232153102120236195078095060175247156207017211010103028114220124034130240117145254219254033155045005047239078194151069046079070183018189212027047160149217209104087248066084218074058116092050039205230083213242005024005240136181132157082086163026190130135091082108110207201221054015199035099196134233065178192055099127054099246103112139239250141005079167145084227060105205060239050062055132230193093055231229147114145070053122056160088051009150224047042086155200088194123184236247224180011204219175233083224038156020091032234003094037213198208204180179052135091203087205122056209213016067119021144085194085143093189213036248139236102248135209215241003203067064208195068200246109052160102130109108022240179218014228151053229135063062141230187108055156254191247129153044095060119032202029067026196218145152099003048214185124002087170159195024081241055042146020226018054070158085017165034239192080200042008049131055095187086238044198171004235055163220094227026152042094072035156144152038068092029100190205218227077161009117107140143070061010100080208208238008246059127239105100129218063230243070165012077048056228142091135063096016218125232203021025236177015133059067156078211016076085046177117160165202141063027024223148025202139245073081237072209233088096226188177185130209081231020008216158205131195223012015117173190097203089063229003209088131179201070011107178211215108010226045064220179086250207214213160117235025208195037028070098089022032136139100250111048037154120026070165249143131087055099225018174077121018148074170104097182098025131055161132216224107195017106131220238010215100225156143046050236159222160023153219083002015063008015079087249053207032050247242016065145086080127192042075241243231114090249022079163087140067243098025191015185240134033165172075010137190083135119109234010156142046132113028115253162159093132016101222140166114032212130186228105125100084236139144053128169243126005145070126200071184210193003050212072073171160018080097044174111169218091032204091164061208204169039216109170196161094180078050158036241160014154133220242246057014149097132146024037176254254124242117175068093022231140189182097243224198068080039076217002023190072203246179044003094208055198217061234103223104032092024249022221089121035237091089192234165126168133064254202225214201088167021039037068099206179214068199041078094140036056024072095046037110047164179115110165049243140069085064212135101060031172040164075131134017225015088242073064034157066101251202018203034146075066054073159095178218024222248218065160005216068186191219168113155077009070188161002165029033197158210033061161073207054154052095171245239135045023089217148026115145015140224210108132174189190014135055174174153061116057222044093092162200201230011172181246019153198093239048172107111187220012105249214205248201176017247140196170044108104068183052160205009248096192045096055019244014202160156010158117065204051053049192216072216186247010017104047120072227119243217013223156011211169080204195165186228007043162227092135183034027157124110021157170108251031037214115229158041183174234170146237099233081024125044250031157055225089014083053217128060142114088139143223032099134118028163219020194030134147039016017041096173006232039160140164226224160032162125209158067221022082188181135172047218186115176218213064199145087133173095071008201023104188143202060088005089210139252127041246073105070122162120177156105020205097120106195024093133139143053209086106174152198091115249175177074056095176133111107230003111148134231015171203020127130067139198076010217023091153030115146248054117244106052087222043074030173008219002088197169182106142025216109031091107121205096236253254083192086216080037146074210187018214205005129232200254046208200085160245219240068155122199233199148104047173100247136132048177245057066136050213166023233015202187068155001143061207116092228130053069154205068133054105111191043145233152066208021155048235239162017183172007182076146186210062161118017078181219056195106178158098152231245006074148188166093225116206141080245186038048177241047060162200155073210245009144141181245123095162126039155248011101254037101163201234130112057112200169148020205039200212226171212174122078143054139130252103203078111223049068236185015174210131092008045125226102124007004104152098042164210070004143191178207103030171214106006221128021130048207168206071011060075092175124121062015170176130168157026251090043244100110039054076168227075136212042183150219119152154161237067242080162032079139202117167072053099187249146191026187204243093034145073229109081092038104093235230011186250151033238180025072214149190112096095114168054251088199074023029235069147108155027053149024152080145175144114049095254183037085063077069152004153092228120122049133095170051214190112162111245186219223253054246147025124160193006165078063160171020247171161068142064124140234086190077099048166100172254188158017216017230118101070140173168194126166078106131070068131065083216164098187111237013253089182192213065199168193095195046130202094247102133028229247017093145050084012053216226200184065016030067111168204006232250187051082114217231083017167145064089028085007158076205207239048096123202125057002138068090166153115183109210014028051146029242050103109165142193040178118121097033249094134079048075096212195246212055120137131170214208041054045166018140102055032231095009223235050092203164032130153020088073234215059169063171013182108111155121053250047061193046083151082118041184135202040141068249003057033125205022111206009120067110212147133214020131069227165176144229145099124164029252005216174097021076251252252224057035235170105133033185071067159200044181227159024006032181164077121175055004142221033181176018037044179029182152217169062006204016127002071245176152138120245134023014054099192159157197239005111107122021210157174210145252039083168132158067141215097132043029184041146217017099106113026154105007250059022069167190012201230042065025078151031075141022245045165056248210017237222143040145251127014244056068041172045249119150076234026244111185157226003070250075037211076169169097136223139082137144117101134093085060075168236093075152132159025191170174052084089107009201240087027069185099155186167240148068170076063121133007199002201152126182252238011089252080152217177194229170216111250184232237111107066211236208140120186052010160198067076132139139003104167202016164100077253209044199132043007135041198111160130204016051176099062164082061191244125089036046064023008047153060243039005222042061178124192196157169247249234051097165132011203188089104125162195131035103187191017164154093190202076096159210153178058138253188219123111248070157049236252030150211162166168226049025178043188126249063161073069095002014091152023125200212114097089177136204160049159043062138195015182170050166142178073166046219073204097041194223007137214162064078236155170053182125021034075115038107211174217085171177109094207100090138231011007171115190087045170168236019222009240235176073233219022094063215017064178152078097010026230146001200153136145230237183015009019236159082091247159224063143185034198196111064182126111219240223236045077143185253215010006109198223167060118184195165176213041218045059059247131052161162004077173172110115014046038094096241006225068136124171013059170134020245173237116241153028081140192040058121207055212157188170153138087077032163020005236150221020136242007012151093044098207235072237233230123217138120183162125163158007002231253093250083154020132220112221105206127074045211198250060100097060250222227234106031055074045209042173234003230189181239130113135234071163112168203008134153004063220126044023015204152240178156149029069138036152170190122254122187141143021046018035232042016119075190158202156220198211118072091113073218147156113082078183109076070081024241056117020167058038201185169190067056043160022210080190183208248128009181136193201146175174180146089153044027043165159054200189202015222191223134030079131133006089129102021109043111035226054166014173043244101222175031209119046119226088050149172147001140023242245192167063013222029136142247037208195037146246064174010033038242159031208220011057211254120060132254205179148248039044154044210030024237065160035180162218232045126225191170148057002123211163066059140073078126230049022018210047234015125091228252009194061170247210216073096021094060052228045161171094171167175090079012205077230074217220142202115097150219144238187038173226161221098049228003236181165152081193173036233223089144117088218091232147164091015129248193121112185166161196128183029122211095176237117120111031126116070135023164241216157232071102056044056231196148073081114170108215204226228079070166132234045154251096173052184041181240241131056078223225064184006134048185207193019121237188107140018251164120137007094056192034095178159046102110106031069160181020109220021106177049213047247175079093106110224208069207063029186105124086095134087239185183150170111216032104104224122154254129164065039202016024114200117053254007247094060153018097099073029101103147016065126152209190213230231175120186084101232048190133123084138079157214074137171027116154164056194219160222126179054203048205005109207008102079086102190112019147077133072053169116208096244018208154104135093161156210219155181078251070036195147122150030255199171023012142185025144138210032069156198178159067192137049111145191191195217238047046040245117199036121066188014161247039092202025026174032229005045113148030040062239239110025100038148045012127156182132030006018060073062047158096184238234007248107105079014099109140245170251214124045016140101032009250021011034168223145071152117011073248011123081198212091054107001134098202255222202036185194068155243163211131148172245012007153155188056165064253049211039212156028018245161059136196132214095242110126165157028205090219200162073012199176037153118090007214087150136125095187047034063129069151144022127176067023204074214182075061043040222054252037237068019153124042162099129154008248084090152187065080102009007069101187075124189243096003158012023124136066105089205120231067206132106048083255168117057104226119104167164226143176250057174210221063066203021003008131233220032243189246091026045133122096191146177146159009251107088075111130093074041050027012216222230080222036031198098185075150061003097048136195193119101055192053138058223049050038102079159120176203132213156197046086108228181243247205221088214113198247183246021163186090087106249191160012222044235008004093056126035218237167148031070046170135248125223223098165237078253138233253104177205098157109129060145078202226064171175238080145069069086125019031036039133187210227016093216088107066191064187252050067199250176061055218255246158136069020006032081179134032088207141096148038110065074095020134142154020023025222081061133179120045159050085197077105251038070083106003226155158133005239037051243017151117142053034029078221026025230104055022045068174230124023186069164024168120194092105205058136216165091245142231215209049187094019011183110081171231009148178200173041058191039060137074235188200132057167242053017017215007019160227006165143223188138008210107016210033131040148201084225165093154106043106096176173131241102144089138231184239177008191165186040019224198177020128040048133072111026025099153154135143207050171058222011172238038070223245094043133238084188091125134199223197026193015103077104227118167037106189055115091043142092086089239246089085014185085072112178173124146049098004214084246160239133157242170162216130062052006173197005111027197206100160037068220214097197019026241158090078163202171034158124031059020121140031170065035070110242187031030028187070110170238195237073252088101209076076191102160054188224233118117224135056243046116137147155077063156148183233029125039103064230084035157012034082249047083134117011020136004095106159069219024006105124156023081145007082169146063116056141088206068157240055076221172187217239134210233002160158196239059237167133198128246229229047196011201224128174174219148076094212020093210036154080087212116054051043224170149083138156188222220234154187215120119084078130045030124243220170018101089125168249064233115080254188157202175230064065112103218075163112034113120125200058215154230104061249083184090100245104030067165007063184236165230141084083130115024122122060064050150078156071049079057194160141096168208028231234096069119120185143064002181033050035071234248186253156173233051145171101163101180224150185047233064175081018014137213073215104162090064050087049040085138162018054244148129118152241173042063018065112073050235097005013016082029057032163120148125188246093063066224226128027153036179253014101124140168087088170199009238247068254059071166236070089132171220115193164232040054087163159225234078094089160063088021113250185182232072162061072213157091168073095077095072231025123192177154056112095172082187053022207037057225250231138176165190230167056174241103138124079053213232195077225102029204087218015152054142169251053030170212115051136115230195059173216052081049128146010033080179196142213196035141023049146053202240100248107104246101096197081245187181004064143054037138009093034087040253081008035241002047114022045107089200112048168057160161015085180221015023042088200217173218174141098053208014040050019239236201147061202119061113200034162054121145195090136099128021254208226106119163222068056177024070172127251048027064172031105099133106066089232035002131059003093238229145091118030079217065207165100084083059092186213175071185081238211146114181025234039067105242108100037146015038183160126154248200151214092160131208090083156146226090116229202025163112064165217142048145026117126216169122169067088005077154142113160131255044222156042078082064137114040216211230096051038131201067048173009247016114126225100243120045073216197120063141232108128179236077174216218057060050136137106246226082100117066004073059163022149147091083205034064164173145181021065242211235027130221144044195251079137242104184193153018164011202095057010162178053204118008052106108225020069026159060010148059235066253031145240181232236171155126016070143053252249012128005126069063235024040091044191237008020163016218062222084080029236134119225039187025213018124172187099242193101251221224192008059250045199171211135065170193004058034074011218173027015170146185072007038198150093153210162063054016231143253031118134121110119195132195132070188070024117208179078055182084148236032078088064229140231075153179061144117245212190247114158222005151167223147092168108205163226217074075042152162159073130236092046009048200156136206189004220178228067126037055072226004022254037083151229134223039108252052136216021008134192067238100099164040185070097223160127087073059014129168031102071084131007085134250031015148118016120197011030194196225176223021171036070006120030054113254231021038142206043249073211101184102124130227198202044238011101130041194140152005098166196204135173093012184196175110036058165007147045143181186048167048176173227043244153206066062201060007118246067030061029130107211010070111069088018206216075067156026041208128246233243036015207006049064003167126199136178186113036135234081155132231040221013215144154018244035034141178160099022136050245156085005242195162189018202232120239007213077212128253194090138042227118020184028037204118028166216034084187088044037094057059154161214079215066071148198083178088202237156120073070240145076174194245168122237124080128222211022120204026055127019112011161020054149052105084180085124192179209148157011048023125200086090013123123155006163089048034176209071116041223068140026108006067056086063123087198200217114124078036166031254226220243153006109053138076117152252116250150032153137154134098087091057085156043205064178176237017220154049210127106172249088106231036239054198140243237187083054248018130234195089037061038221238039243242225110049006059149163046085185043240237103143241144139036222235217052199087231026157220108092214136212135220047180141006004107250059153209061152032129062019147249075148106122102108214241183161182064243083139178221129063211128175137234053038122132097184031181055222047073244080106050035197098073003023215212007016141249172012012139174013231200213120137240116003131039216027078081121244226109121206202054114149149158095208177058071089212033139075070106060204196149071061153230189119117076101020179245253216095003079177175215152166179123168149059234050064180196113083084167138014107003242133143078060223105174219186142136133116199133125070016143184097248099026057034207127127074138020235045196030102146002175196113222214036096171187113078155121032055019138145179047113179196037171076092017203078030081106032054234022096091201081042088088200007215099142165086111203237208241118204150006038198159244100201069149134192016131006012028211226034008149113163124091205026140055251173116096016149231131007015206105093042047235097128198181042178077146172043086109212204050193055015202227153082192069199171161254116131068193172097040084089033004192209094169229103010166238100089224004072040047217009049224200099023174216100160026026164075169051240240240238196234132007068022030137211246146202197129177203032091092198208063123058205085087171106222152058126196041009112166073217153078118091076193114198240244206059185111078184188171119177093079222102185145047074220127226176102125072192102219242230154120116161235052182254136077252146194234206022092023078162157177253065193104207048073195251083172171139225239135192151234046163222059214119209115217250177095121178139128179207165249129106141216026132023196175185056004026072032139052124008066014118079203080057087141069154139235026238207194061178215240087062233235036032078012243248126062179100083016108037008023103126028154044108049239108226252124191177100177162052056008167018165165188164079245121243210251100249209016254059067151254099184233102209034041008035169121181228050074246227238144221180098038116100041062219130242119131048056123105169093006113224148181233207004018022225106094030082125101090148130107018094192053055016068167175226051170095047143230026054173002236241113169002046118199166049133052139020209190159037003107016148176215150151189134004171098192247152164211212071142206090073150237025049226225022107058162051211030243173166243121090213239078178197174228175107203124094045134089072038064219122204063092246007254240175099164210088098062170057084193021138132236144241089063176095035179159095060142017186052045040239072138224075055224179003213070152206079101071248131014245115047105143189167198180150036043251228125158160248221213014192103055079254107116178043068161102210101116250170015085051029154228124254022178153219252108152182019223200050213088127155171254118116010136191194236182191109132017208039192129175017072018219121185009131180115037070162157019068248117088032132063106169045200125080180153224181236020206095031156163112214195205042014083122207098238176179153019135244231132081107207008210178078080103184161205151024156114014159160073159132157235230024109077187105243103070085207050054001179100056049188243013153154004025051179092017130054021025127160191179098187223112037082221163091085250038051208184076206198210244241213006168233241108197145172113232059168033142045189217217057184146075093098217087066112069218249079100218088048188179209167120164088061010020134210032030079247102045209040073026133244024076144127091249007064160194189092248154087203055222005240183223133059117174154133019240212138170004033034109115027121088084166090034196233019110125087217045112235117126064130013030125045120096223117187049059034095127128065177129154053156025084080070119254108059115208112116113066195252219018067096172196101097064247009247158166235247031088128195212248005049022222255032062255200157079213101164069013056019034120049245149059012208099203123179069084093189194197016002080151141216112169148060086107213229065042207184194212179031163083166201176249164235143064110080077179038009055113033250212098100029010195171093066021064114143018016085049255086027230201142186202112094207021034120237049148202136178120057056009159193204181089185045040011042025161112039168019181206232171014249056044190032154139071228247152166016222136149208033241064205065065164012234196109215133206185003205046229116108078153198049121053228220130227217029027026026158072165024112132035006192096030093026208132092079200235042175251203176199191190077114151190075054011117089160152244205202133046090045081184215084253208140071249239179057183092154068015097021058226099025161193027147041122020029047032178137220028041028045144092183166245009195035250081196129238145180208224136138219255055141081009209194255148144210128078009019165137167017003073002185252215043003019002103133141194196068020122201105224019090096123144089174060198178031106221130251054079079018025212108170173043212249011164112059233068146143012010079060220052146200021075207156240043188249236141160036008072243150147070255090092121114181204118165153175237236145190208013094160219151080202094156021134062006151194181056002026015145107029058236142107200084038060058252028183046238096028165029202066056130128156083166179063049056219063178251017210205029161205058212131181245122185201056231163216222081141223028023131188015060120211023247099084218059165181057218200017150222159158048030138156162239002196149178038213019009184130123126085122168182216216177212205191039101217188056067146064149078051052254196013237008124216048061102120010129077087039209198156189225006102063055058244218247243017027018177026143134204197155112161205115202034229254125070002219030046175036133067244126042106140080126032225243087151179177115026019128175046130231023042236108212056117197101068242188156225132161250182114020213232172190144155007196016215055206120087204150064247076159098039025165120039156062118200055147088017168060151104251188041016252014031085108024123018167226083203031064040066194251003116135076191229129095158141069013028033114003113170209003197238085074088039101217054228066160208189166212014220055002039111245063221218164019075223052237208134147054103211218077097233237138212033232244206236190108050133140123083094179183095155107208136035024177018083252220078249015112061142097185066156170017236151128116080105004045019080156204120237198175051185196114180170052015202212081026177153064245057253130221085145109105072150102209157019162199071157091172011180171155182228187185073181034198153241118224013196098091138194104037160011142130149226113230251185107176102054107207043116229074008177208244078176114159243176159017147215035064109020112217086044149016084173101082166034248238169029124109107116196036015041080138042202155195002164005187054221121228002175129155146253021113185183116175028017055013081219065197019204211040017186042071170033047202036201194129061159088181175251028086251079082161193190093217012029220205140021194151138113190192170251074120016055075232033138222010066031049119040157111043223201165238214204120130148029191033080188102097152204146036106209030091055013202141104212161214236131207194233210104108062156094173169020126155168118158149129048111243048021248018236061169254064093231172122126147011223031145053120085112181102203030069251247036019188247125209048199094030005137180140140010158172206179022195010176089178002082045075254165037113185055086140242222017080051098158022220225145074126218164079101017052003111026205039206128102120012127014169181024098170219212090193020058043174055223041227230012057250251050016125017072034203161120091255236142025148182141155139076150015104071231217046111230230033021213092197124116031122152014100011126003187151141228227164132188006223139102222029220006136162250157153091146106232222215220219113008159031033056069067155066170174220064016220144151019060201145159118241124052110083254243022223036163210127189129222214192238087094222184193206019196166222032203161194086012233051027180239155105198132247214183"

nn.init_weights(nn_weights_str)


def strategy_dev_policy(board_copy, player):
    global current_time, move_count, predicted_total_moves, start_time

    start_time = time.time()

    tree.graph = []
    tree.graph.append(Node(-1, Move(0, 0, 0, True), 0))  # Root node

    mcts_engine.root_node_index = 0

    mcts_engine.board = board_copy
    mcts_engine.player = player

    allocated_time = max(current_time / max(12, (predicted_total_moves - move_count)) - 0.05, 0.1)
    # print(allocated_time, current_time)

    mcts_engine.max_time = allocated_time

    # print_board(board_copy, None)
    # print(score(board_copy))
    # print(mcts_engine.get_result(board_copy))

    # print("IPS: ", mcts_engine.iterations / allocated_time, mcts_engine.iterations, allocated_time)

    best_index = mcts_engine.search()

    # print("ITERATIONS: ", mcts_engine.iterations)

    best_node = tree.graph[best_index]
    move = best_node.last_move

    # mcts_engine.root_node_index = best_index

    '''
    print(mcts_engine.root_node_index, tree.graph[mcts_engine.root_node_index].children_start, 
          tree.graph[mcts_engine.root_node_index].children_end)
    '''
    # print("SEL_DEPTH:", mcts_engine.sel_depth)
    # print(best_node.win_count, best_node.visits, best_node.win_count / best_node.visits)
    # print(move.get_key(), move.p)

    move_count += 1

    current_time -= (time.time() - start_time)

    if move.p:
        # real_board[move.get_key] = player
        return None

    return move.get_key()
